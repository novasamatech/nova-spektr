name: Coverage report

on:
  pull_request:
    types: [ labeled ]

jobs:
  test-coverage:
    if: ${{ github.event.label.name == 'coverage-check' }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: ⚙️ Install dependencies
        uses: ./.github/workflows/install-pnpm

      - name: Coverage report
        uses: ArtiomTr/jest-coverage-report-action@main
        id: coverage
        with:
            output: report-markdown
            package-manager: pnpm
            skip-step: install

      - name: Make comment with report
        uses: marocchino/sticky-pull-request-comment@v2
        with:
            message: ${{ steps.coverage.outputs.report }}
